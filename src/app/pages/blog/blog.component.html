<div class="blog-page">
  <section class="blog-hero">
    <div class="container">
      <div class="hero-content">
        <h1>Blog y Publicaciones</h1>
        <p>Comparte contenido, imágenes, videos y conecta con la comunidad</p>
      </div>
    </div>
    <div class="hero-wave">
      <svg viewBox="0 0 1200 120" preserveAspectRatio="none">
        <path d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z"></path>
      </svg>
    </div>
  </section>

  <section class="blog-content">
    <div class="container">
      <div class="blog-header">
        <h2>Publicaciones Recientes</h2>
        @if (currentUser()) {
          <button class="btn-create" (click)="showCreateModal.set(true)">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            Crear Publicación
          </button>
        }
      </div>

      @if (loading()) {
        <div class="loading-container">
          <span class="spinner"></span>
          <span>Cargando publicaciones...</span>
        </div>
      } @else if (posts().length === 0) {
        <div class="empty-state">
          <p>No hay publicaciones aún. ¡Sé el primero en compartir!</p>
        </div>
      } @else {
        <div class="posts-grid">
          @for (post of posts(); track post.id) {
            <article class="post-card" (click)="openPost(post)">
              @if (post.images && post.images.length > 0) {
                <div class="post-image">
                  <img [src]="post.images[0]" [alt]="post.content">
                </div>
              } @else if (post.video) {
                <div class="post-video">
                  <video [src]="post.video" controls></video>
                </div>
              }
              <div class="post-content">
                <div class="post-header">
                  <div class="post-author">
                    @if (post.authorPhoto) {
                      <img [src]="post.authorPhoto" [alt]="post.authorName" class="author-avatar">
                    }
                    <span class="author-name">{{ post.authorName }}</span>
                  </div>
                  <span class="post-date">{{ formatDate(post.createdAt) }}</span>
                </div>
                <p class="post-text">{{ post.content }}</p>
                <div class="post-stats">
                  <button class="stat-btn" (click)="likePost(post); $event.stopPropagation()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" [class.liked]="isLiked(post)">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                    </svg>
                    {{ (post.likes || []).length }}
                  </button>
                  <button class="stat-btn" (click)="openPost(post); $event.stopPropagation()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                    </svg>
                    {{ (post.comments || []).length }}
                  </button>
                </div>
              </div>
            </article>
          }
        </div>
      }
    </div>
  </section>

  <!-- Create Post Modal -->
  @if (showCreateModal()) {
    <div class="modal-overlay" (click)="showCreateModal.set(false)">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Crear Publicación</h3>
          <button class="close-btn" (click)="showCreateModal.set(false)">
            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <textarea 
            [(ngModel)]="newPostContent" 
            placeholder="¿Qué estás pensando?"
            class="post-textarea"
            rows="6">
          </textarea>
          <div class="file-uploads">
            <label class="file-label">
              <input type="file" accept="image/*" multiple (change)="onImageSelect($event)">
              <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              Imágenes
            </label>
            <label class="file-label">
              <input type="file" accept="video/*" (change)="onVideoSelect($event)">
              <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
              </svg>
              Video
            </label>
          </div>
          @if (newPostImages().length > 0 || newPostVideo()) {
            <div class="selected-files">
              @for (img of newPostImages(); track $index) {
                <span class="file-tag">{{ img.name }}</span>
              }
              @if (newPostVideo()) {
                <span class="file-tag">{{ newPostVideo()!.name }}</span>
              }
            </div>
          }
          <button class="btn-submit" (click)="createPost()" [disabled]="uploading() || !newPostContent().trim()">
            @if (uploading()) {
              <span class="spinner"></span>
              Publicando...
            } @else {
              Publicar
            }
          </button>
        </div>
      </div>
    </div>
  }

  <!-- View Post Modal -->
  @if (showPostModal() && selectedPost()) {
    <div class="modal-overlay" (click)="closePostModal()">
      <div class="post-modal-content" (click)="$event.stopPropagation()">
        <div class="post-modal-header">
          <button class="close-btn" (click)="closePostModal()">
            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        <div class="post-modal-body">
          <div class="post-modal-image">
            @if (selectedPost()!.images && selectedPost()!.images!.length > 0) {
              <img [src]="selectedPost()!.images![0]" [alt]="selectedPost()!.content">
            } @else if (selectedPost()!.video) {
              <video [src]="selectedPost()!.video" controls></video>
            }
          </div>
          <div class="post-modal-sidebar">
            <div class="post-modal-author">
              @if (selectedPost()!.authorPhoto) {
                <img [src]="selectedPost()!.authorPhoto" [alt]="selectedPost()!.authorName" class="author-avatar">
              }
              <span class="author-name">{{ selectedPost()!.authorName }}</span>
            </div>
            <div class="post-modal-comments">
              <p class="post-text">{{ selectedPost()!.content }}</p>
              <div class="comments-list">
                @for (comment of selectedPost()!.comments || []; track $index) {
                  <div class="comment-item">
                    <div class="comment-header">
                      @if (comment.authorPhoto) {
                        <img [src]="comment.authorPhoto" [alt]="comment.authorName" class="comment-avatar">
                      }
                      <span class="comment-author">{{ comment.authorName }}</span>
                    </div>
                    <p class="comment-content">{{ comment.content }}</p>
                    <div class="comment-actions">
                      <button class="comment-btn" (click)="likeComment($index)">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5" />
                        </svg>
                        {{ (comment.likes || []).length }}
                      </button>
                      <button class="comment-btn" (click)="dislikeComment($index)">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14H5.236a2 2 0 01-1.789-2.894l3.5-7A2 2 0 018.736 3h4.018a2 2 0 01.485.06l3.76.94m-7 10v5a2 2 0 002 2h.096c.5 0 .905-.405.905-.904 0-.715.211-1.413.608-2.008L17 13V4m-7 10h2m5-10h2a2 2 0 012 2v6a2 2 0 01-2 2h-2.5" />
                        </svg>
                        {{ (comment.dislikes || []).length }}
                      </button>
                    </div>
                  </div>
                }
              </div>
            </div>
            <div class="post-modal-actions">
              <button class="action-btn" (click)="likePost(selectedPost()!)">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" [class.liked]="isLiked(selectedPost()!)">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
              </button>
              <div class="comment-input-container">
                <input 
                  type="text" 
                  [(ngModel)]="newComment" 
                  placeholder="Escribe un comentario..."
                  class="comment-input"
                  (keyup.enter)="addComment()">
                <button class="send-btn" (click)="addComment()">
                  <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  }
</div>

