<div class="profile-page">
  @if (loading()) {
    <div class="loading-container">
      <span class="spinner"></span>
      <span>Cargando perfil...</span>
    </div>
  } @else if (profile()) {
    <div class="profile-header">
      <div class="container">
        <div class="profile-info">
          <div class="profile-avatar">
            @if (profile()!.photoURL) {
              <img [src]="profile()!.photoURL" [alt]="profile()!.displayName">
            } @else {
              <div class="avatar-placeholder">
                {{ profile()!.displayName.charAt(0).toUpperCase() }}
              </div>
            }
          </div>
          <div class="profile-details">
            <div class="profile-name-section">
              <h1 class="profile-username">{{ profile()!.displayName }}</h1>
              @if (isOwnProfile()) {
                <button class="btn-edit" routerLink="/profile/edit">
                  <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                  </svg>
                  Editar Perfil
                </button>
              } @else {
                <button class="btn-follow" [class.following]="isFollowing()" (click)="followUser()">
                  {{ isFollowing() ? 'Siguiendo' : 'Seguir' }}
                </button>
              }
            </div>
            <div class="profile-stats">
              <div class="stat-item">
                <span class="stat-number">{{ getPostsCount() }}</span>
                <span class="stat-label">publicaciones</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">{{ getFollowersCount() }}</span>
                <span class="stat-label">seguidores</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">{{ getFollowingCount() }}</span>
                <span class="stat-label">siguiendo</span>
              </div>
            </div>
            <div class="profile-bio">
              <p class="profile-name">{{ profile()!.displayName }}</p>
              @if (profile()!.bio) {
                <p class="bio-text">{{ profile()!.bio }}</p>
              }
              @if (profile()!.gameName && profile()!.tagLine) {
                <p class="game-info">
                  <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
                  </svg>
                  {{ profile()!.gameName }}#{{ profile()!.tagLine }}
                </p>
              }
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="profile-content">
      <div class="container">
        <div class="posts-tabs">
          <button class="tab-btn active">
            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            PUBLICACIONES
          </button>
        </div>

        @if (posts().length === 0) {
          <div class="empty-posts">
            <svg width="64" height="64" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <p>No hay publicaciones aún</p>
          </div>
        } @else {
          <div class="posts-grid">
            @for (post of posts(); track post.id) {
              <div class="post-thumbnail" (click)="openPost(post)">
                @if (post.images && post.images.length > 0) {
                  <img [src]="post.images[0]" [alt]="post.content">
                } @else if (post.video) {
                  <div class="video-thumbnail">
                    <video [src]="post.video" muted></video>
                    <div class="play-overlay">
                      <svg width="32" height="32" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M8 5v14l11-7z"/>
                      </svg>
                    </div>
                  </div>
                } @else {
                  <div class="text-post">
                    <p>{{ post.content }}</p>
                  </div>
                }
                <div class="post-overlay">
                  <div class="overlay-stats">
                    <span>
                      <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                      </svg>
                      {{ (post.likes || []).length }}
                    </span>
                    <span>
                      <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                      </svg>
                      {{ (post.comments || []).length }}
                    </span>
                  </div>
                </div>
              </div>
            }
          </div>
        }
      </div>
    </div>
  }

  <!-- Post Modal -->
  @if (showPostModal() && selectedPost()) {
    <div class="modal-overlay" (click)="closePostModal()">
      <div class="post-modal-content" (click)="$event.stopPropagation()">
        <div class="post-modal-header">
          <button class="close-btn" (click)="closePostModal()">
            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        <div class="post-modal-body">
          <div class="post-modal-image">
            @if (selectedPost()!.images && selectedPost()!.images!.length > 0) {
              <img [src]="selectedPost()!.images![0]" [alt]="selectedPost()!.content">
            } @else if (selectedPost()!.video) {
              <video [src]="selectedPost()!.video" controls></video>
            }
          </div>
          <div class="post-modal-sidebar">
            <div class="post-modal-author">
              @if (selectedPost()!.authorPhoto) {
                <img [src]="selectedPost()!.authorPhoto" [alt]="selectedPost()!.authorName" class="author-avatar">
              }
              <span class="author-name">{{ selectedPost()!.authorName }}</span>
            </div>
            <div class="post-modal-comments">
              <p class="post-text">{{ selectedPost()!.content }}</p>
              <div class="comments-list">
                @for (comment of selectedPost()!.comments || []; track $index) {
                  <div class="comment-item">
                    <div class="comment-header">
                      @if (comment.authorPhoto) {
                        <img [src]="comment.authorPhoto" [alt]="comment.authorName" class="comment-avatar">
                      }
                      <span class="comment-author">{{ comment.authorName }}</span>
                    </div>
                    <p class="comment-content">{{ comment.content }}</p>
                    <div class="comment-actions">
                      <button class="comment-btn" (click)="likeComment($index)">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5" />
                        </svg>
                        {{ (comment.likes || []).length }}
                      </button>
                      <button class="comment-btn" (click)="dislikeComment($index)">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14H5.236a2 2 0 01-1.789-2.894l3.5-7A2 2 0 018.736 3h4.018a2 2 0 01.485.06l3.76.94m-7 10v5a2 2 0 002 2h.096c.5 0 .905-.405.905-.904 0-.715.211-1.413.608-2.008L17 13V4m-7 10h2m5-10h2a2 2 0 012 2v6a2 2 0 01-2 2h-2.5" />
                        </svg>
                        {{ (comment.dislikes || []).length }}
                      </button>
                    </div>
                  </div>
                }
              </div>
            </div>
            <div class="post-modal-actions">
              <button class="action-btn" (click)="likePost(selectedPost()!)">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" [class.liked]="isLiked(selectedPost()!)">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
              </button>
              <div class="comment-input-container">
                <input 
                  type="text" 
                  [(ngModel)]="newComment" 
                  placeholder="Añade un comentario..."
                  class="comment-input"
                  (keyup.enter)="addComment()">
                <button class="send-btn" (click)="addComment()">
                  <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  }
</div>

