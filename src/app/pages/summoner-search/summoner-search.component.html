<div class="search-container">
  <!-- Hero -->
  <div class="search-hero">
    <h1>Buscar Jugador de League of Legends</h1>
    <p>Encuentra estadÃ­sticas y ranking de cualquier invocador</p>
  </div>

  <!-- Search Form -->
  <div class="search-form-container">
    <form (ngSubmit)="searchSummoner()" class="search-form">
      <div class="form-row">
        <div class="form-group">
          <label for="gameName">Nombre del Jugador</label>
          <input
            type="text"
            id="gameName"
            [(ngModel)]="gameName"
            name="gameName"
            placeholder="Ej: Faker"
            class="form-input"
          />
        </div>

        <div class="form-group">
          <label for="tagLine">Tagline</label>
          <input
            type="text"
            id="tagLine"
            [(ngModel)]="tagLine"
            name="tagLine"
            placeholder="Ej: KR1"
            class="form-input"
          />
        </div>
      </div>

      <div class="form-group">
        <label for="region">RegiÃ³n</label>
        <select
          id="region"
          [(ngModel)]="selectedRegion"
          name="region"
          class="form-select"
        >
          @for (region of regions; track region.code) {
            <option [value]="region.code">{{ region.name }}</option>
          }
        </select>
      </div>

      <button type="submit" class="btn-search" [disabled]="loading()">
        @if (loading()) {
          <span class="spinner"></span>
          <span>Buscando...</span>
        } @else {
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          <span>Buscar</span>
        }
      </button>
    </form>

    <!-- Error Message -->
    @if (error()) {
      <div class="error-message">
        <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
        </svg>
        <span>{{ error() }}</span>
      </div>
    }
  </div>

  <!-- Results -->
  @if (summoner()) {
    <div class="results-container">
      <!-- Profile Card -->
      <div class="profile-card">
        <div class="profile-header">
          <img 
            [src]="getProfileIconUrl(summoner()!.profileIconId)" 
            [alt]="summoner()!.gameName"
            class="profile-icon"
            (error)="$any($event.target).src='https://ddragon.leagueoflegends.com/cdn/14.24.1/img/profileicon/29.png'"
          />
          <div class="profile-info">
            <h2 class="summoner-name">
              {{ summoner()!.gameName }}
              <span class="tagline">#{{ summoner()!.tagLine }}</span>
            </h2>
            <div class="summoner-level">
              <span class="level-badge">Nivel {{ summoner()!.summonerLevel }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Ranked Stats -->
      <div class="ranked-container">
        <h3 class="section-title">EstadÃ­sticas Rankeadas</h3>
        
        
        @if (summonerData()?.leagues && summonerData()!.leagues.length > 0) {
          <!-- Queue Toggle -->
          <div class="queue-toggle">
            <button 
              class="toggle-btn" 
              [class.active]="selectedQueue() === 'RANKED_SOLO_5x5'"
              (click)="switchQueue('RANKED_SOLO_5x5')"
            >
              Solo/Duo
            </button>
            <button 
              class="toggle-btn" 
              [class.active]="selectedQueue() === 'RANKED_FLEX_SR'"
              (click)="switchQueue('RANKED_FLEX_SR')"
            >
              Flex
            </button>
          </div>

          @if (getCurrentLeague()) {
            <div class="ranked-stats-container">
              <!-- Rank Info - Estilo Blitz.gg -->
              <div class="rank-info-card blitz-style">
                <div class="rank-header">
                  <h4>{{ getQueueDisplayName(selectedQueue()) }}</h4>
                </div>
                
                <div class="rank-content">
                  <div class="rank-emblem-container">
                    <img 
                      [src]="getRankImageUrl(getCurrentLeague()!.tier)" 
                      [alt]="getCurrentLeague()!.tier"
                      class="rank-emblem"
                    />
                  </div>
                  
                  <div class="rank-info-section">
                    <div class="rank-tier-info">
                      <span class="rank-tier" [style.color]="getTierColor(getCurrentLeague()!.tier)">
                        {{ getCurrentLeague()!.tier }} {{ getCurrentLeague()!.rank }}
                      </span>
                      <span class="rank-lp">{{ getCurrentLeague()!.leaguePoints }} LP</span>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="lp-progress-container">
                      <div class="lp-progress-bar">
                        <div 
                          class="lp-progress-fill" 
                          [style.width.%]="getLPProgress()"
                        ></div>
                      </div>
                    </div>
                    
                    <div class="rank-stats-row">
                      <span class="winrate">{{ getWinRate(getCurrentLeague()!) }}% WR</span>
                      <span class="wins-losses">
                        {{ getCurrentLeague()!.wins }}W - {{ getCurrentLeague()!.losses }}L
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- LP Graph - Estilo Blitz.gg -->
              <div class="lp-graph-card blitz-style">
                <h4>LP Graph</h4>
                <div class="lp-graph-container">
                  <svg class="graph-svg" viewBox="0 0 400 200">
                    <!-- Grid lines -->
                    <defs>
                      <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                        <path d="M 40 0 L 0 0 0 40" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
                      </pattern>
                    </defs>
                    <rect width="100%" height="100%" fill="url(#grid)" />
                    
                    <!-- Graph line and points -->
                    @if (getLPHistory().length > 0) {
                      <!-- LÃ­nea de conexiÃ³n suave -->
                      <path 
                        [attr.d]="getSmoothPath()"
                        class="graph-line"
                        fill="none"
                      />
                      
                      <!-- Puntos individuales - centrados en la lÃ­nea -->
                      @for (point of getLPHistory(); track $index; let i = $index) {
                        <circle 
                          [attr.cx]="getPointX(i)"
                          [attr.cy]="getPointY(i)"
                          r="5"
                          [class]="point.isWin ? 'win-point' : 'loss-point'"
                        />
                      }
                    }
                  </svg>
                </div>
              </div>
            </div>
          } @else {
            <div class="no-ranked">
              <div class="sad-face">ðŸ˜ž</div>
              <p>No hay datos de {{ getQueueDisplayName(selectedQueue()) }} para este jugador</p>
            </div>
          }
        } @else {
          <div class="no-ranked">
            <div class="sad-face">ðŸ˜ž</div>
            <p>Este jugador no tiene partidas rankeadas esta temporada</p>
            <p class="no-ranked-subtitle">Las estadÃ­sticas rankeadas aparecerÃ¡n cuando el jugador juegue partidas de Solo/Duo o Flex</p>
          </div>
        }
      </div>

      <!-- Champion Mastery -->
      <div class="mastery-container">
        <h3 class="section-title">Campeones con Mayor MaestrÃ­a</h3>
        
        @if (loadingMatches()) {
          <div class="loading-container">
            <span class="spinner"></span>
            <span>Cargando campeones...</span>
          </div>
        } @else if (championMastery().length > 0) {
          <div class="mastery-grid">
            @for (champ of championMastery(); track champ.championId) {
              <div class="mastery-card">
                <img 
                  [src]="getChampionImageUrl(champ.championId)" 
                  [alt]="getChampionNameById(champ.championId)"
                  class="champion-icon"
                  (error)="$any($event.target).src='https://ddragon.leagueoflegends.com/cdn/14.24.1/img/profileicon/29.png'"
                />
                <div class="mastery-info">
                  <div class="champion-name">{{ getChampionNameById(champ.championId) }}</div>
                  <div class="mastery-level">Nivel {{ champ.championLevel }}</div>
                  <div class="mastery-points">{{ formatMasteryPoints(champ.championPoints) }} puntos</div>
                </div>
              </div>
            }
          </div>
        }
      </div>

      <!-- Match History -->
      <div class="matches-container">
        <h3 class="section-title">Partidas Recientes</h3>
        
        @if (loadingMatches()) {
          <div class="loading-container">
            <span class="spinner"></span>
            <span>Cargando historial...</span>
          </div>
        } @else if (matches().length > 0) {
          <div class="matches-list">
            @for (match of matches(); track match.metadata.matchId) {
              @let participant = getParticipantData(match);
              @if (participant) {
                <div class="match-card" [class.win]="participant.win" [class.loss]="!participant.win">
                  <div class="match-result">
                    <span class="result-text">{{ participant.win ? 'VICTORIA' : 'DERROTA' }}</span>
                    <span class="match-mode">{{ getQueueName(match.info.queueId) }}</span>
                  </div>

                  <div class="match-champion">
                    <img 
                      [src]="'https://ddragon.leagueoflegends.com/cdn/14.1.1/img/champion/' + participant.championName + '.png'" 
                      [alt]="participant.championName"
                      class="match-champion-icon"
                      (error)="$any($event.target).src='https://ddragon.leagueoflegends.com/cdn/14.24.1/img/profileicon/29.png'"
                    />
                    <div class="champion-details">
                      <div class="champion-name-match">{{ participant.championName }}</div>
                      <div class="champion-level">Nivel {{ participant.champLevel }}</div>
                    </div>
                  </div>

                  <div class="match-stats">
                    <div class="kda">
                      <span class="kda-numbers">{{ participant.kills }}/{{ participant.deaths }}/{{ participant.assists }}</span>
                      <span class="kda-ratio">KDA: {{ getKDA(participant) }}</span>
                    </div>
                    <div class="farm">
                      <span>{{ participant.totalMinionsKilled }} CS</span>
                    </div>
                    <div class="duration">
                      <span>{{ getMatchDuration(match.info.gameDuration) }}</span>
                    </div>
                  </div>
                </div>
              }
            }
          </div>
        } @else {
          <div class="no-matches">
            <p>No se encontraron partidas recientes</p>
          </div>
        }
      </div>
    </div>
  }
</div>

