<div class="search-container">
  <div class="search-hero">
    <h1>Buscar Jugador de League of Legends</h1>
    <p>Encuentra estadísticas y ranking de cualquier invocador</p>
  </div>

  <div class="search-form-container">
    <form (ngSubmit)="searchSummoner()" class="search-form">
      <div class="form-row">
        <div class="form-group">
          <label for="gameName">Nombre del Jugador</label>
          <input
            type="text"
            id="gameName"
            [(ngModel)]="gameName"
            name="gameName"
            placeholder="Ej: Faker"
            class="form-input"
          />
        </div>

        <div class="form-group">
          <label for="tagLine">Tagline</label>
          <input
            type="text"
            id="tagLine"
            [(ngModel)]="tagLine"
            name="tagLine"
            placeholder="Ej: KR1"
            class="form-input"
          />
        </div>
      </div>

      <div class="form-group">
        <label for="region">Región</label>
        <select
          id="region"
          [(ngModel)]="selectedRegion"
          name="region"
          class="form-select"
        >
          @for (region of regions; track region.code) {
            <option [value]="region.code">{{ region.name }}</option>
          }
        </select>
      </div>

      <button type="submit" class="btn-search" [disabled]="loading()">
        @if (loading()) {
          <span class="spinner"></span>
          <span>Buscando...</span>
        } @else {
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          <span>Buscar</span>
        }
      </button>
    </form>

    @if (error()) {
      <div class="error-message">
        <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
        </svg>
        <span>{{ error() }}</span>
      </div>
    }
  </div>

  @if (summoner()) {
    <div class="results-container">
      <div class="profile-card">
        <div class="profile-header">
          <img 
            [src]="getProfileIconUrl(summoner()!.profileIconId)" 
            [alt]="summoner()!.gameName"
            class="profile-icon"
            (error)="$any($event.target).src='https://ddragon.leagueoflegends.com/cdn/14.24.1/img/profileicon/29.png'"
          />
          <div class="profile-info">
            <h2 class="summoner-name">
              {{ summoner()!.gameName }}
              <span class="tagline">#{{ summoner()!.tagLine }}</span>
            </h2>
            <div class="summoner-level">
              <span class="level-badge">Nivel {{ summoner()!.summonerLevel }}</span>
            </div>
          </div>
        </div>
      </div>


      <div class="stats-mastery-container">
        <div class="ranked-stats-section">
          <h3 class="section-title">Estadísticas Rankeadas</h3>
          
          <div class="development-message">
            <svg width="40" height="40" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="dev-icon">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <h4>En Desarrollo</h4>
            <p>Las estadísticas rankeadas están siendo mejoradas. Pronto tendrás acceso a información detallada de ranking, LP y historial de partidas.</p>
          </div>
        </div>

        <div class="mastery-section">
          <h3 class="section-title">Campeones con Mayor Maestría</h3>
          
          @if (loadingMatches()) {
            <div class="loading-container">
              <span class="spinner"></span>
              <span>Cargando campeones...</span>
            </div>
          } @else if (championMastery().length > 0) {
            <div class="mastery-grid">
              @for (champ of championMastery(); track champ.championId) {
                <div class="mastery-card">
                  <img 
                    [src]="getChampionImageUrl(champ.championId)" 
                    [alt]="getChampionNameById(champ.championId)"
                    class="champion-icon"
                    (error)="$any($event.target).src='https://ddragon.leagueoflegends.com/cdn/14.24.1/img/profileicon/29.png'"
                  />
                  <div class="mastery-info">
                    <div class="champion-name">{{ getChampionNameById(champ.championId) }}</div>
                    <div class="mastery-level">Nivel {{ champ.championLevel }}</div>
                    <div class="mastery-points">{{ formatMasteryPoints(champ.championPoints) }} puntos</div>
                    
                    @if (champ.worldRank || champ.serverRank) {
                      <div class="ranking-info">
                        @if (champ.worldRank) {
                          <div class="rank-item world-rank">
                            <i class="fas fa-globe"></i>
                            <span>Mundial: #{{ champ.worldRank }}</span>
                          </div>
                        }
                        @if (champ.serverRank) {
                          <div class="rank-item server-rank">
                            <i class="fas fa-server"></i>
                            <span>Servidor: #{{ champ.serverRank }}</span>
                          </div>
                        }
                      </div>
                    }
                  </div>
                </div>
              }
            </div>
          }
        </div>
      </div>

      <div class="matches-container">
        <div class="matches-header">
          <h3 class="section-title">Partidas Recientes</h3>
          <div class="matches-count">{{ matches().length }} partidas</div>
        </div>
        
        @if (loadingMatches()) {
          <div class="loading-container">
            <span class="spinner"></span>
            <span>Cargando historial...</span>
          </div>
        } @else if (matches().length > 0) {
          <div class="matches-list">
            @for (match of matches(); track match.metadata.matchId) {
              @let participant = getParticipantData(match);
              @if (participant) {
                <div class="match-card" 
                     [class.win]="participant.win" 
                     [class.loss]="!participant.win"
                     (click)="openMatchDetails(match)"
                     [title]="'Click para ver detalles de la partida'">
                  <div class="match-result">
                    <span class="result-text">{{ participant.win ? 'VICTORIA' : 'DERROTA' }}</span>
                    <span class="match-mode">{{ getQueueName(match.info.queueId) }}</span>
                  </div>

                  <div class="match-champion">
                    <img 
                      [src]="'https://ddragon.leagueoflegends.com/cdn/14.24.1/img/champion/' + participant.championName + '.png'" 
                      [alt]="participant.championName"
                      class="match-champion-icon"
                      (error)="$any($event.target).src='https://ddragon.leagueoflegends.com/cdn/14.24.1/img/profileicon/29.png'"
                    />
                    <div class="champion-details">
                      <div class="champion-name-match">{{ participant.championName }}</div>
                      <div class="champion-level">Nivel {{ participant.champLevel }}</div>
                    </div>
                  </div>

                  <div class="match-stats">
                    <div class="kda">
                      <span class="kda-numbers">{{ participant.kills }}/{{ participant.deaths }}/{{ participant.assists }}</span>
                      <span class="kda-ratio">KDA: {{ getKDA(participant) }}</span>
                    </div>
                    <div class="farm">
                      <span>{{ participant.totalMinionsKilled }} CS</span>
                    </div>
                    <div class="duration">
                      <span>{{ getMatchDuration(match.info.gameDuration) }}</span>
                    </div>
                  </div>
                  
                  <div class="match-click-hint">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="click-icon">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122" />
                    </svg>
                    <span class="click-text">Click para detalles</span>
                  </div>
                </div>
              }
            }
          </div>
        } @else {
          <div class="no-matches">
            <p>No se encontraron partidas recientes</p>
          </div>
        }
      </div>
    </div>
  }
  
  <!-- Modal de detalles de la partida -->
  <div class="match-modal" *ngIf="selectedMatch()" (click)="closeMatchDetails()">
    <div class="match-modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">Detalles de la Partida</h3>
        <button class="close-modal-btn" (click)="closeMatchDetails()">
          <span>✕</span>
        </button>
      </div>
      
      <div class="modal-body" *ngIf="selectedMatch()">
        <div class="match-info">
          <div class="match-mode-info">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="mode-icon">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
            </svg>
            <span class="mode-name">{{ getQueueName(selectedMatch()!.info.queueId) }}</span>
          </div>
          <div class="match-duration">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="duration-icon">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span class="duration-text">{{ getMatchDuration(selectedMatch()!.info.gameDuration) }}</span>
          </div>
          <div class="match-date">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="date-icon">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <span class="date-text">{{ formatTimestamp(selectedMatch()!.info.gameCreation) }}</span>
          </div>
        </div>
        
        <div class="teams-container">
          <!-- Equipo Azul (Victoria) -->
          <div class="team blue-team" [class.winner]="getTeamWon(selectedMatch()!, 100)">
            <div class="team-header">
              <h4 class="team-title">Equipo Azul</h4>
              <div class="team-result" *ngIf="getTeamWon(selectedMatch()!, 100)">
                <span class="win-text">VICTORIA</span>
              </div>
            </div>
            <div class="players-list">
              @for (participant of getTeamPlayers(selectedMatch()!, 100); track participant.puuid) {
                <div class="player-card" 
                     (click)="searchPlayer(participant.summonerName)"
                     [title]="'Click para buscar a ' + participant.summonerName">
                  <img 
                    [src]="'https://ddragon.leagueoflegends.com/cdn/14.24.1/img/champion/' + participant.championName + '.png'" 
                    [alt]="participant.championName"
                    class="player-champion-icon"
                    (error)="$any($event.target).src='https://ddragon.leagueoflegends.com/cdn/14.24.1/img/profileicon/29.png'"
                  />
                  <div class="player-info">
                    <div class="player-name">{{ participant.summonerName }}</div>
                    <div class="player-champion">{{ participant.championName }}</div>
                    <div class="player-kda">{{ participant.kills }}/{{ participant.deaths }}/{{ participant.assists }}</div>
                  </div>
                  <div class="player-items">
                    @for (item of [participant.item0, participant.item1, participant.item2, participant.item3, participant.item4, participant.item5, participant.item6]; track $index) {
                      <div class="item-slot" *ngIf="item > 0">
                        <img 
                          [src]="'https://ddragon.leagueoflegends.com/cdn/14.24.1/img/item/' + item + '.png'" 
                          [alt]="'Item ' + item"
                          class="item-icon"
                          (error)="$any($event.target).src='https://ddragon.leagueoflegends.com/cdn/14.24.1/img/item/0.png'"
                        />
                      </div>
                    }
                  </div>
                </div>
              }
            </div>
          </div>
          
          <!-- Equipo Rojo (Derrota) -->
          <div class="team red-team" [class.winner]="getTeamWon(selectedMatch()!, 200)">
            <div class="team-header">
              <h4 class="team-title">Equipo Rojo</h4>
              <div class="team-result" *ngIf="getTeamWon(selectedMatch()!, 200)">
                <span class="win-text">VICTORIA</span>
              </div>
            </div>
            <div class="players-list">
              @for (participant of getTeamPlayers(selectedMatch()!, 200); track participant.puuid) {
                <div class="player-card" 
                     (click)="searchPlayer(participant.summonerName)"
                     [title]="'Click para buscar a ' + participant.summonerName">
                  <img 
                    [src]="'https://ddragon.leagueoflegends.com/cdn/14.24.1/img/champion/' + participant.championName + '.png'" 
                    [alt]="participant.championName"
                    class="player-champion-icon"
                    (error)="$any($event.target).src='https://ddragon.leagueoflegends.com/cdn/14.24.1/img/profileicon/29.png'"
                  />
                  <div class="player-info">
                    <div class="player-name">{{ participant.summonerName }}</div>
                    <div class="player-champion">{{ participant.championName }}</div>
                    <div class="player-kda">{{ participant.kills }}/{{ participant.deaths }}/{{ participant.assists }}</div>
                  </div>
                  <div class="player-items">
                    @for (item of [participant.item0, participant.item1, participant.item2, participant.item3, participant.item4, participant.item5, participant.item6]; track $index) {
                      <div class="item-slot" *ngIf="item > 0">
                        <img 
                          [src]="'https://ddragon.leagueoflegends.com/cdn/14.24.1/img/item/' + item + '.png'" 
                          [alt]="'Item ' + item"
                          class="item-icon"
                          (error)="$any($event.target).src='https://ddragon.leagueoflegends.com/cdn/14.24.1/img/item/0.png'"
                        />
                      </div>
                    }
                  </div>
                </div>
              }
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

