<div class="search-container">
  <div class="search-hero">
    <h1>Buscar Jugador de League of Legends</h1>
    <p>Encuentra estad칤sticas y ranking de cualquier invocador</p>
  </div>

  <div class="search-form-container">
    <form (ngSubmit)="searchSummoner()" class="search-form">
      <div class="form-row">
        <div class="form-group">
          <label for="gameName">Nombre del Jugador</label>
          <input
            type="text"
            id="gameName"
            [(ngModel)]="gameName"
            name="gameName"
            placeholder="Ej: Faker"
            class="form-input"
          />
        </div>

        <div class="form-group">
          <label for="tagLine">Tagline</label>
          <input
            type="text"
            id="tagLine"
            [(ngModel)]="tagLine"
            name="tagLine"
            placeholder="Ej: KR1"
            class="form-input"
          />
        </div>
      </div>

      <div class="form-group">
        <label for="region">Regi칩n</label>
        <select
          id="region"
          [(ngModel)]="selectedRegion"
          name="region"
          class="form-select"
        >
          @for (region of regions; track region.code) {
            <option [value]="region.code">{{ region.name }}</option>
          }
        </select>
      </div>

      <button type="submit" class="btn-search" [disabled]="loading()">
        @if (loading()) {
          <span class="spinner"></span>
          <span>Buscando...</span>
        } @else {
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          <span>Buscar</span>
        }
      </button>
    </form>

    @if (error()) {
      <div class="error-message">
        <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
        </svg>
        <span>{{ error() }}</span>
      </div>
    }
  </div>

  @if (summoner()) {
    <div class="results-container">
      <div class="profile-card">
        <div class="profile-header">
          <img 
            [src]="getProfileIconUrl(summoner()!.profileIconId)" 
            [alt]="summoner()!.gameName"
            class="profile-icon"
            (error)="$any($event.target).src='https://ddragon.leagueoflegends.com/cdn/14.24.1/img/profileicon/29.png'"
          />
          <div class="profile-info">
            <h2 class="summoner-name">
              {{ summoner()!.gameName }}
              <span class="tagline">#{{ summoner()!.tagLine }}</span>
            </h2>
            <div class="summoner-level">
              <span class="level-badge">Nivel {{ summoner()!.summonerLevel }}</span>
            </div>
          </div>
        </div>
      </div>


      <div class="stats-mastery-container">
        <div class="ranked-stats-section">
          <h3 class="section-title">Estad칤sticas Rankeadas</h3>
          
          <div class="development-message">
            <div class="dev-icon">游뚾</div>
            <h4>En Desarrollo</h4>
            <p>Las estad칤sticas rankeadas est치n siendo mejoradas. Pronto tendr치s acceso a informaci칩n detallada de ranking, LP y historial de partidas.</p>
          </div>
        </div>

        <div class="mastery-section">
          <h3 class="section-title">Campeones con Mayor Maestr칤a</h3>
          
          @if (loadingMatches()) {
            <div class="loading-container">
              <span class="spinner"></span>
              <span>Cargando campeones...</span>
            </div>
          } @else if (championMastery().length > 0) {
            <div class="mastery-grid">
              @for (champ of championMastery(); track champ.championId) {
                <div class="mastery-card">
                  <img 
                    [src]="getChampionImageUrl(champ.championId)" 
                    [alt]="getChampionNameById(champ.championId)"
                    class="champion-icon"
                    (error)="$any($event.target).src='https://ddragon.leagueoflegends.com/cdn/14.24.1/img/profileicon/29.png'"
                  />
                  <div class="mastery-info">
                    <div class="champion-name">{{ getChampionNameById(champ.championId) }}</div>
                    <div class="mastery-level">Nivel {{ champ.championLevel }}</div>
                    <div class="mastery-points">{{ formatMasteryPoints(champ.championPoints) }} puntos</div>
                    
                    @if (champ.worldRank || champ.serverRank) {
                      <div class="ranking-info">
                        @if (champ.worldRank) {
                          <div class="rank-item world-rank">
                            <i class="fas fa-globe"></i>
                            <span>Mundial: #{{ champ.worldRank }}</span>
                          </div>
                        }
                        @if (champ.serverRank) {
                          <div class="rank-item server-rank">
                            <i class="fas fa-server"></i>
                            <span>Servidor: #{{ champ.serverRank }}</span>
                          </div>
                        }
                      </div>
                    }
                  </div>
                </div>
              }
            </div>
          }
        </div>
      </div>

      <div class="matches-container">
        <div class="matches-header">
          <h3 class="section-title">Partidas Recientes</h3>
          <div class="matches-count">{{ matches().length }} partidas</div>
        </div>
        
        @if (loadingMatches()) {
          <div class="loading-container">
            <span class="spinner"></span>
            <span>Cargando historial...</span>
          </div>
        } @else if (matches().length > 0) {
          <div class="matches-list">
            @for (match of matches(); track match.metadata.matchId) {
              @let participant = getParticipantData(match);
              @if (participant) {
                <div class="match-card" [class.win]="participant.win" [class.loss]="!participant.win">
                  <div class="match-result">
                    <span class="result-text">{{ participant.win ? 'VICTORIA' : 'DERROTA' }}</span>
                    <span class="match-mode">{{ getQueueName(match.info.queueId) }}</span>
                  </div>

                  <div class="match-champion">
                    <img 
                      [src]="'https://ddragon.leagueoflegends.com/cdn/14.24.1/img/champion/' + participant.championName + '.png'" 
                      [alt]="participant.championName"
                      class="match-champion-icon"
                      (error)="$any($event.target).src='https://ddragon.leagueoflegends.com/cdn/14.24.1/img/profileicon/29.png'"
                    />
                    <div class="champion-details">
                      <div class="champion-name-match">{{ participant.championName }}</div>
                      <div class="champion-level">Nivel {{ participant.champLevel }}</div>
                    </div>
                  </div>

                  <div class="match-stats">
                    <div class="kda">
                      <span class="kda-numbers">{{ participant.kills }}/{{ participant.deaths }}/{{ participant.assists }}</span>
                      <span class="kda-ratio">KDA: {{ getKDA(participant) }}</span>
                    </div>
                    <div class="farm">
                      <span>{{ participant.totalMinionsKilled }} CS</span>
                    </div>
                    <div class="duration">
                      <span>{{ getMatchDuration(match.info.gameDuration) }}</span>
                    </div>
                  </div>
                </div>
              }
            }
          </div>
        } @else {
          <div class="no-matches">
            <p>No se encontraron partidas recientes</p>
          </div>
        }
      </div>
    </div>
  }
</div>

